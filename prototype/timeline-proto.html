<!DOCTYPE html>
<html>
<head><title>Timeline Prototype</title></head>
<body>
  <pg-timeline-viewer width="1000" height="400" x-axis="time">
    <pg-timeline>
      <pg-event x="20" label="Foo" />
      <pg-event start-x="25" end-x="30" label="Bar" />
    </pg-timeline>
  </pg-timeline-viewer>
</body>
<script>
var polygraph = (() => {
  'use strict';
  
  var polygraph = {};
  
  const svgNamespace = 'http://www.w3.org/2000/svg';
    
  class AbstractMethodError {}
  
  class Axis {
    min(lhsVal, rhsVal) {
      return ( lhsVal <= rhsVal ) ? lhsVal : rhsVal;
    }
    
    toPixel(val, minVal, maxVal, maxPixel) {
      throw new AbstractMethodError('toPixel');
    }
  }
  polygraph.Axis = Axis;
  
  
  // TODO: Switch to dictionary?
  var axisDefs = {};
  polygraph.defineAxis = (name, axis) => {
    axisDefs[name] = axis;
  };
  
  class RawAxis extends Axis {
    toPixel(val, minVal, maxVal, maxPixel) {
      return val;
    }
  }

  var properties = (() => {
    var properties = {};
    
    class AbstractElementProperty {
      constructor(element, prop) {
        this._element = element;
        this._prop = prop;
      }
      
      get() {
        throw AbstractMethodError('get');
      }
      
      set(val) {
        throw AbstractMethodError('set(val)');
      }
      
      connect(element) {
        if ( element.hasAttribute(this._prop) ) {
          element[this._prop] = element.getAttribute(this._prop);
        }
      }
    }
    
    properties.AttributeProperty = class extends AbstractElementProperty {
      constructor(element, prop) {
        super(element, prop);
      }
      
      get() {
        return this._element.getAttribute(this._prop);
      }
      
      set(val) {
        this._element.setAttribute(this._prop, val);
      }
    };
    
    properties.AttributeNSProperty = class extends AbstractElementProperty {
      constructor(element, ns, prop) {
        super(element, prop);
        this._ns = ns;
      }
      
      get() {
        return this._element.getAttributeNS(this._ns, this._prop);
      }
      
      set(val) {
        this._element.setAttributeNS(this._ns, this._prop, val);
      }
    }
    
    properties.StyleProperty = class extends AbstractElementProperty {
      constructor(element, ns, prop) {
        super(element, prop);
      }
      
      get() {
        return this._element.style[this._prop];
      }
      
      set(val) {
        this._element.style[this._prop] = val;
      }
    }
    
    return properties;
  })();  
  
  var viewport = (() => {
    var viewport = {};
    
    viewport.AxisModel = class {
      constructor(axis) {
        this._axis = axis;
      }
    
      min(lhsVal, rhsVal) {
        return this._xAxis.min(lhsVal, rhsVal);
      }
    
      get bounds() {
        return {min: this._min, max: this._max};
      }
    }
    
    viewport.SvgViewportMixin = class {
      constructor() {
        this._div = document.createElement('div');
        this._svg = document.createElementNS(svgNamespace, 'svg');
      
        this._div.appendChild(this._svg);
      }
    
      connect(viewerElement) {
        const widthProp = new properties.StyleProperty(this._div, 'width');
        widthProp.connect(viewerElement);
      
        const heightProp = new properties.StyleProperty(this._div, 'height');
        heightProp.connect(viewerElement);
      }
    
      connectXAxis(viewerElement) {
      
      }
    
      connectYAxis(viewerElement) {
      }
    
      get element() {
        return this._div;
      }
    }
    
    return viewport;
  })();

  
  class AbstractViewer extends HTMLElement {
    constructor() {
      super();
      
      const shadowRoot = this.attachShadow({mode: 'open'});
      
      this._viewport = new viewport.SvgViewportMixin();
      shadowRoot.appendChild(this._viewport.element);
    }
  }

  class TimelineViewer extends AbstractViewer {
    constructor() {
      super();
    }
    
    connectedCallback() {
      this._viewport.connect(this);
    }
  }
  
  class Timeline extends HTMLElement {
    constructor() {
      super();
    }
    
    set label(label) {
      return this.setAttribute('label', label);
    }
    
    get label() {
      return this.getAttribute('label');
    }
  }
  
  class TimelineEvent extends HTMLElement {
    constructor() {
      super();
    }
    
    set label(label) {
      return this.setAttribute('label', label);
    }
    
    get label() {
      return this.getAttribute('label');
    }
    
    set x(x) {
      this.startX = x;
      this.endX = x;
    }
    
    set startX(x) {
      return this.getAttribute('start-x');
    }
    
    get startX() {
      return this.getAttribute('start-x');
    }
    
    set endX(x) {
      return this.setAttribute('end-x', x);
    }
    
    get endX() {
      return this.getAttribute('end-x');
    }
  }
    
  polygraph.init = (optPrefix) => {
    const prefix = optPrefix || 'pg';
      
    window.customElements.define(prefix + '-timeline-viewer', TimelineViewer);
  };
  return polygraph;
})();

polygraph.init();
</script>
</html>